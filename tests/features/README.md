# Features テストスイート

このディレクトリには、特徴量抽出モジュール（`src.features`）のテストが含まれています。

## テスト対象モジュール

- `src.features.bug_metrics` - バグ関連特徴量の抽出
- `src.features.change_metrics` - 変更関連特徴量の抽出
- `src.features.developer_metrics` - 開発者関連特徴量の抽出
- `src.features.project_metrics` - プロジェクト関連特徴量の抽出
- `src.features.refactoring_metrics` - リファクタリング関連特徴量の抽出
- `src.features.review_metrics` - レビュー関連特徴量の抽出

## テストファイル構成

### `test_bug_metrics.py`
バグ関連特徴量抽出のテスト：
- **バグタイトル解析**: バグキーワードの検出
- **バグ重要度分析**: クリティカル度の評価
- **バグ影響範囲**: 影響を受けるコンポーネント分析
- **修正パターン**: バグ修正の特徴的パターン

### `test_change_metrics.py`
変更関連特徴量抽出のテスト：
- **変更サイズ**: 追加・削除・修正行数
- **変更複雑度**: McCabe複雑度、サイクロマティック複雑度
- **ファイル影響度**: 変更されたファイル数と種類
- **変更パターン**: 典型的な変更パターンの検出

### `test_developer_metrics.py`
開発者関連特徴量抽出のテスト：
- **開発者経験値**: コミット履歴、プロジェクト参加期間
- **専門領域**: 主に扱うファイル・コンポーネント
- **コードレビュー活動**: レビュー頻度、品質
- **チーム内協力**: 他開発者との連携度

### `test_project_metrics.py`
プロジェクト関連特徴量抽出のテスト：
- **プロジェクト規模**: コードベースサイズ、開発者数
- **活動レベル**: コミット頻度、リリース頻度
- **技術スタック**: 使用言語、フレームワーク
- **品質指標**: バグ密度、テストカバレッジ

### `test_refactoring_metrics.py`
リファクタリング関連特徴量抽出のテスト：
- **リファクタリング検出**: コード構造変更の識別
- **品質改善度**: 可読性、保守性の向上度
- **リファクタリング範囲**: 影響を受けるモジュール
- **パフォーマンス影響**: 実行効率への影響

### `test_review_metrics.py`
レビュー関連特徴量抽出のテスト：
- **レビューコメント解析**: 修正要求・確認コメントの分類
- **レビュー期間**: レビューにかかる時間
- **レビュー品質**: レビューの詳細度、有効性
- **レビュー参加者**: レビュアーの専門性、多様性

## 特徴量の種類

### 数値特徴量
- コード行数、ファイル数
- 複雑度メトリクス
- 時間関連メトリクス（日数、時間）
- 参加者数、コメント数

### カテゴリ特徴量
- プログラミング言語
- ファイルタイプ
- バグ重要度レベル
- 開発者役割

### テキスト特徴量
- コミットメッセージ
- レビューコメント
- バグレポート
- コードコメント

### 時系列特徴量
- 開発活動の時間的パターン
- リリースサイクル
- バグ発生頻度の変遷

## テスト内容

### 機能テスト
- ✅ 各特徴量抽出関数の正常動作
- ✅ 入力データ形式の検証
- ✅ 出力データの妥当性確認
- ✅ データ型とレンジの検証

### エラーハンドリングテスト
- ✅ 不正な入力データの処理
- ✅ 欠損データの扱い
- ✅ ゼロ除算エラーの対応
- ✅ メモリ不足時の処理

### エッジケーステスト
- ✅ 空のデータセット
- ✅ 極端に大きい/小さい値
- ✅ 異常値（外れ値）の処理
- ✅ 重複データの処理

### データ品質テスト
- ✅ 特徴量の分布確認
- ✅ 相関関係の検証
- ✅ 異常値検出
- ✅ データ一貫性の確認

## テスト実行方法

### 全テスト実行
```bash
pytest tests/features/ -v
```

### 個別モジュールテスト
```bash
pytest tests/features/test_bug_metrics.py -v
pytest tests/features/test_change_metrics.py -v
pytest tests/features/test_developer_metrics.py -v
pytest tests/features/test_project_metrics.py -v
pytest tests/features/test_refactoring_metrics.py -v
pytest tests/features/test_review_metrics.py -v
```

### パフォーマンステスト
```bash
pytest tests/features/ -k "performance" -v
```

### カバレッジ付き実行
```bash
pytest tests/features/ --cov=src.features --cov-report=html
```

## テストデータ

テストで使用するサンプルデータ：
- **Change データ**: OpenStackプロジェクトの実際の変更データ
- **Commit データ**: Gitコミット情報
- **レビューデータ**: コードレビューコメントとメタデータ
- **プロジェクトメタデータ**: プロジェクト設定と統計情報

## モック使用について

外部依存関係のモック：
- **ファイルシステム**: テストデータの読み込み
- **API呼び出し**: 外部サービスとの連携
- **データベース**: 永続化データの取得

## 特徴量品質保証

### データ検証
- 特徴量の値域チェック
- 欠損値の適切な処理
- データ型の一貫性
- 異常値の検出と対応

### 統計的検証
- 分布の正常性
- 相関関係の妥当性
- 多重共線性の確認
- スケールの適切性

## 継続的改善

新しい特徴量を追加する際のガイドライン：
1. **特徴量設計**: 明確な定義と計算方法
2. **テスト設計**: 包括的なテストケース
3. **データ検証**: 品質保証プロセス
4. **ドキュメント**: 特徴量の説明と使用例
5. **パフォーマンス**: 計算効率の考慮

## 機械学習との連携

抽出された特徴量は以下で使用されます：
- **IRL（逆強化学習）モデル**: レビュー優先度の学習
- **予測モデル**: バグ予測、リスク評価
- **可視化**: ダッシュボード、レポート生成
- **分析**: データ分析、インサイト抽出
